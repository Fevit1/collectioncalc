# Claude Working Notes - CollectionCalc / Slab Worthy Project

## Executive Summary

**Purpose:** This document helps Claude quickly get up to speed when starting a new session with Mike on the Slab Worthy project.

**The Project:** Slab Worthy is an AI-powered comic grading tool. The flagship feature uses patent-pending multi-angle photography to assess whether comics are worth professional grading. Powered by CollectionCalc backend.

**The Human:** Mike is a Product Manager (not a developer). He's comfortable with Git, Render deployments, and SQL queries, but needs guidance on complex debugging and architecture decisions. He wants Claude to push back and share knowledge proactively.

**Current State (v4.2.1):**
- **REBRANDED TO SLAB WORTHY** - slabworthy.com is live!
- **Email system complete** - Resend configured for slabworthy.com
- FMV uses eBay + Whatnot data (10x more sales!)
- Reprint filter active (Spawn #1 fix)
- Barcode scanning infrastructure ready
- eBay Collector extension v1.0.3, Whatnot Valuator v2.41.2

---

## ðŸš¨ IMMEDIATE ACTION ITEMS

### Pre-Beta MUST-HAVES
- [ ] **Content moderation system** - Amazon Rekognition integration
- [ ] **Mobile testing** - full Slab Worthy grading flow on phone

### Branding Decisions Needed
- [ ] **collectioncalc.com** - currently shows Slab Worthy branding. Should it stay CollectionCalc-branded as the backend hub?
- [ ] **Chrome extensions** - still reference CollectionCalc
- [ ] **Tone consideration** - "Slab Worthy" is casual/playful phrase. Current design may be too formal. Consider more playful branding?

### Backlog
- [ ] **Two-factor authentication** - TOTP (authenticator app) recommended
- [ ] **AI-powered support inbox** - Route support@slabworthy.com through Claude for auto-responses

---

## Session 25 Summary (February 3, 2026 - Evening)

### Completed
1. **Privacy & Terms Deployed**
   - privacy.html and terms.html pushed to Cloudflare Pages
   - Accessible at slabworthy.com/privacy.html and slabworthy.com/terms.html

2. **Resend Configured for slabworthy.com**
   - Added domain to existing Resend account
   - Cloudflare auto-configured DNS records (DKIM, SPF, MX)
   - All records verified âœ…

3. **Email Routing Set Up**
   - support@slabworthy.com â†’ forwards to Mike's Yahoo
   - Using Cloudflare Email Routing (not Resend receiving)
   - AI-powered inbox routing is future feature

4. **Email Templates Rebranded**
   - Updated auth.py: all emails now say "Slab Worthy" instead of "CollectionCalc"
   - From address: noreply@slabworthy.com
   - Updated: verification, password reset, approval, rejection emails
   - Render env vars updated: RESEND_FROM_EMAIL, FRONTEND_URL

5. **Forgot Password Flow Tested**
   - Full flow working: request â†’ email â†’ reset form â†’ success
   - Emails branded correctly, links go to slabworthy.com

### Issues Encountered & Resolved
- **Browser cached 301 redirect** - Old redirect from slabworthy.com â†’ collectioncalc.com was cached. Fixed by disabling cache in DevTools or clearing browser data.
- **Render cache** - Had to "Clear build cache & deploy" to get new auth.py changes live

### Decisions Made
- **Skip username for now** - email + password is sufficient for private beta
- **Two-factor auth** - Added to backlog, TOTP recommended when ready
- **AI support inbox** - Future feature, forwarding to Yahoo works for now

---

## Session 24 Summary (February 3, 2026 - Earlier)

### Completed
1. **Privacy Policy (privacy.html)**
   - Covers: account info (name, email), progressive PII collection, comic images, usage data
   - Third-party services: Cloudflare, Render, Resend, R2, Anthropic (Claude)
   - User rights: access, delete, export, opt-out
   - US-focused (no GDPR popup needed, browser cookie controls sufficient)

2. **Terms of Service (terms.html)**
   - Clear "what we do / what we don't do" sections
   - Added eBay/Whatnot listing generation to capabilities
   - **Prohibited Content section** with zero-tolerance policy
   - CSAM reporting to NCMEC language included
   - Comic publisher trademark acknowledgments (Marvel, DC, Image, etc.)
   - CGCÂ®/CBCSÂ® trademark disclaimers
   - Strong liability limitations for grade/value estimates
   - California governing law (appropriate for US-only, bootstrapped)

### Decisions Made
- **Email verification before account creation** â†’ MUST-HAVE for private beta
- **Progressive PII collection** â†’ Collect name at signup, more data over time (billing, collection setup)
- **Content moderation approach:**
  - MVP: Amazon Rekognition for explicit content detection
  - Apply for PhotoDNA (CSAM hash matching)
  - Register for NCMEC CyberTipline ESP account
  - Build incident logging for flagged content
- **Contact form vs raw email** â†’ Contact form with topic dropdown for AI routing
- **Delaware vs California incorporation** â†’ Stay California for now (simpler, cheaper for bootstrapped)

---

## Session 23 Summary (February 2, 2026)

### Major Wins
1. **FMV Now Uses eBay + Whatnot Data (v4.2)**
   - `/api/sales/fmv` queries BOTH tables
   - ASM #300: 6 Whatnot + 53 eBay = 59 total sales
   - Response includes `sources: { whatnot: X, ebay: Y }`

2. **Reprint Filter (v4.2.1)**
   - `is_reprint = false` filter on both tables
   - Text filters: "reprint", "2nd print", "3rd print", etc.
   - Fixes Spawn #1 valuation pollution

3. **Full Slab Worthy Rebrand**
   - slabworthy.com â†’ custom domain on Cloudflare Pages
   - New branding: "Slab Worthyâ„¢ - AI for Comic Collectors"
   - Removed Photo Upload tab
   - Slab Worthy? is now default tab
   - Comic-shaped upload boxes (7:10 cover, 1:6 spine, 14:10 centerfold)
   - Centerfold has dotted center line
   - Desktop: "Upload" text, hidden "Take Photo" button
   - Footer: Contact, Privacy, Terms + "Powered by CollectionCalcâ„¢ Â© 2026"

---

## Technical Debt

### wsgi.py Refactoring Needed
- Currently ~1,900 lines and growing
- Recommendation: Split at ~2,500 lines using Flask Blueprints
- Suggested structure:
  - `routes/auth.py` - authentication endpoints
  - `routes/admin.py` - admin/NLQ endpoints  
  - `routes/sales.py` - FMV, market data
  - `routes/images.py` - R2 upload, barcode scanning
  - `routes/grading.py` - extraction, grading endpoints

### Dead Code
- Barcode backfill endpoints (`/api/admin/backfill-barcodes`, `/api/admin/barcode-stats`) - functional but useless since Whatnot images don't have visible barcodes

---

## Content Moderation System (To Build)

### Architecture
```
User uploads image
    â†“
BEFORE storing/processing:
    â†’ Amazon Rekognition (explicit content detection)
    â†’ If flagged: block upload, log incident
    â†’ If CSAM detected: preserve evidence, report to NCMEC
    â†’ If clean: proceed to comic analysis
```

### Incident Logging Requirements
When content is flagged, capture:
- User ID / Account email
- User's name
- IP address at time of upload
- Timestamp (UTC)
- Image hash (SHA-256 + PhotoDNA hash if available)
- Original filename
- Device/browser fingerprint
- Account creation date + IP
- Any other uploads from same user

**Important:** For confirmed CSAM, hash and report, then delete. Don't retain actual images.

### Setup Steps
1. [ ] Integrate Amazon Rekognition into image upload pipeline
2. [ ] Register for NCMEC CyberTipline ESP account
3. [ ] Apply for PhotoDNA access (Microsoft)
4. [ ] Create `content_incidents` table
5. [ ] Build admin view for reviewing flags
6. [ ] Create incident response procedure document

---

## Contact/Support System (To Build)

### Current State
- support@slabworthy.com â†’ forwards to Mike's Yahoo inbox
- Works for beta, but not scalable

### Future: AI-Powered Support Inbox
```
Email to support@slabworthy.com
    â†“
Resend webhook â†’ API endpoint
    â†“
Claude analyzes (topic, sentiment, urgency)
    â†“
Either: auto-respond via Resend API
Or: forward to Mike with suggested response
```

### Contact Form (Also Planned)
```
Contact Form Fields:
â”œâ”€â”€ Topic Dropdown (required)
â”‚   â”œâ”€â”€ "Delete my data"
â”‚   â”œâ”€â”€ "Export my data"
â”‚   â”œâ”€â”€ "Bug report"
â”‚   â”œâ”€â”€ "Feature request"
â”‚   â”œâ”€â”€ "Billing question"
â”‚   â””â”€â”€ "Other"
â”œâ”€â”€ Email (required)
â”œâ”€â”€ Message (required)
â””â”€â”€ Submit â†’ API endpoint â†’ Resend â†’ route based on topic
```

---

## Business Vision

### "Worthy" Brand Family
- **slabworthy.com** â€” Comics (CGC, CBCS) âœ… LIVE
- **coinworthy.com** â€” Coins (PCGS, NGC) - future
- **cardworthy.com** â€” Cards (PSA, BGS) - future
- **stampworthy.com** â€” Stamps (PSA, PSE) - future

All share one backend (CollectionCalc API). Same pattern:
```
Photo â†’ AI Vision â†’ Grade Estimate â†’ Market Value â†’ "Worth grading?"
```

---

## Quick Reference

### Deployment Commands
```powershell
# Backend (Render Docker)
git add .; git commit -m "message"; git push; deploy

# Frontend (Cloudflare)  
git add .; git commit -m "message"; git push; purge
```

### URLs
- **Frontend:** slabworthy.com (also collectioncalc.com)
- **API:** collectioncalc-docker.onrender.com
- **Service ID:** srv-d5vcjqqli9vc73a5a730

### Email
- **Transactional:** noreply@slabworthy.com (via Resend)
- **Support:** support@slabworthy.com â†’ Yahoo (via Cloudflare Email Routing)

### Render Env Vars (Updated Session 25)
- `RESEND_FROM_EMAIL` = `noreply@slabworthy.com`
- `FRONTEND_URL` = `https://slabworthy.com`

### Test Endpoints
```bash
curl https://collectioncalc-docker.onrender.com/health
# Returns: {"barcode":true,"status":"ok","version":"4.2.1"}

curl "https://collectioncalc-docker.onrender.com/api/sales/fmv?title=spider-man&issue=300"
```

---

## UX Improvements Identified

### Mobile Image Picker
Current: Standard file picker shows tiny thumbnails
Desired: Gallery-style view like native camera app on Pixel
Options to explore:
- Custom image picker component
- PWA with file system access API
- Native-like gallery grid before upload

---

*Last updated: February 3, 2026 (Session 25)*
*Version: 4.2.1*
