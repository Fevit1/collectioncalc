# Claude Working Notes - CollectionCalc / Slab Worthy Project

## Executive Summary

**Purpose:** This document helps Claude quickly get up to speed when starting a new session with Mike on the Slab Worthy project.

**The Project:** Slab Worthy is an AI-powered comic grading tool. The flagship feature uses patent-pending multi-angle photography to assess whether comics are worth professional grading. Powered by CollectionCalc backend.

**The Human:** Mike is a Product Manager (not a developer). He's comfortable with Git, Render deployments, and SQL queries, but needs guidance on complex debugging and architecture decisions. He wants Claude to push back and share knowledge proactively.

**Current State (v4.2.1):**
- **All pages now have consistent header/footer** - Gold logo, matching nav and footer
- **Site restructured** - Marketing at /, auth at /login.html
- **Email system complete** - Resend configured for slabworthy.com
- FMV uses eBay + Whatnot data (10x more sales!)
- Reprint filter active (Spawn #1 fix)
- Barcode scanning infrastructure ready
- eBay Collector extension v1.0.3, Whatnot Valuator v2.41.2

---

## üö® IMMEDIATE ACTION ITEMS

### Pre-Beta MUST-HAVES
- [ ] **Content moderation system** - Amazon Rekognition integration
- [ ] **Mobile testing** - full Slab Worthy grading flow on phone

### Branding ‚úÖ RESOLVED
- [x] **Tagline decided** - "AI for Comic Collectors"
- [x] **Logo style decided** - Gold comic-style with purple drop shadows (Bangers font)
- [x] **Site structure decided** - Marketing homepage + separate login page
- [x] **Header/footer consistency** - All pages updated (Session 27)

### Backlog
- [ ] **Migrate to 11ty static site generator** - Shared header/footer templates instead of duplicating HTML across pages. Cloudflare Pages supports 11ty natively. Would make future updates much easier.
- [ ] **Two-factor authentication** - TOTP (authenticator app) recommended
- [ ] **AI-powered support inbox** - Route support@slabworthy.com through Claude for auto-responses
- [ ] **PostHog integration** - Analytics, A/B tests, session replay (post-beta)
- [ ] **Pricing page content** - Need to finalize pricing model

---

## Session 27 Summary (February 4, 2026)

### Major Accomplishments

1. **Header/Footer Consistency Across All Pages**
   - Updated: pricing.html, about.html, faq.html, terms.html, privacy.html
   - Header: Gold "SLAB WORTHY" logo + "Log In" link (removed "How It Works")
   - Footer: CTA button + logo with tagline + 3-column links (Product, Company, Legal)

2. **Terms & Privacy Pages Restyled**
   - Changed from old indigo gradient to gold/purple brand colors
   - Added Bangers font for logo
   - Consistent with rest of site

3. **Identified Technical Debt: Duplicate HTML**
   - Current pain point: Changing header/footer requires editing 6+ files
   - Solution: Migrate to 11ty static site generator
   - Added to backlog for future session

### Files Updated This Session
- `/pricing.html` - New header/footer
- `/about.html` - New header/footer  
- `/faq.html` - New header/footer
- `/terms.html` - New header/footer + gold logo styling
- `/privacy.html` - New header/footer + gold logo styling
- `CLAUDE_NOTES.txt` - This file

---

## Session 26 Summary (February 4, 2026)

### Major Accomplishments

1. **New Marketing Homepage Deployed**
   - Gold comic-style logo (Bangers font) with purple text-shadow
   - Tagline: "AI for Comic Collectors"
   - "How It Works" scrollytelling section (4 steps, always vertical)
   - Mobile responsive design
   - CTA buttons link to /login.html

2. **Site Restructure**
   - `index.html` ‚Üí New marketing homepage
   - `login.html` ‚Üí Auth page (moved from old index.html)
   - Login page updated: gold logo, removed feature cards, added "‚Üê Home" link

3. **New Pages Deployed**
   - `faq.html` - 10 expandable Q&A items
   - `about.html` - Problem/solution story, values grid, patent mention
   - `pricing.html` - "Coming soon" placeholder with beta note

4. **Logo Clipping Bug Fixed**
   - **Problem:** `background-clip: text` with gradient caused "Y" descender to be cut off
   - **Solution:** Use solid gold color (`#facc15`) with `text-shadow` instead
   - **CSS:** `color: #facc15; text-shadow: 2px 2px 0 #7c3aed, 4px 4px 0 #1e1b4b;`
   - Applied fix to: index.html, login.html, faq.html, about.html, pricing.html

5. **First Beta Testers!**
   - Beta codes in database: BETA-001 through BETA-005 (1 use each)
   - BETA-MIKE already used (Mike's account)
   - Give testers codes like `BETA-001`, `BETA-002`

### Technical Lessons Learned
- `background-clip: text` + gradient clips to text bounding box, cuts off descenders (y, g, p, q)
- `text-shadow` works reliably for comic-style shadow effects
- `filter: drop-shadow` also has clipping issues with text gradients
- PowerShell uses `Copy-Item` not `cp`, semicolons not `&&`

---

## Session 25 Summary (February 3, 2026 - Evening)

### Completed
1. **Privacy & Terms Deployed**
   - privacy.html and terms.html pushed to Cloudflare Pages
   - Accessible at slabworthy.com/privacy.html and slabworthy.com/terms.html

2. **Resend Configured for slabworthy.com**
   - Added domain to existing Resend account
   - Cloudflare auto-configured DNS records (DKIM, SPF, MX)
   - All records verified ‚úÖ

3. **Email Routing Set Up**
   - support@slabworthy.com ‚Üí forwards to Mike's Yahoo
   - Using Cloudflare Email Routing (not Resend receiving)
   - AI-powered inbox routing is future feature

4. **Email Templates Rebranded**
   - Updated auth.py: all emails now say "Slab Worthy" instead of "CollectionCalc"
   - From address: noreply@slabworthy.com
   - Updated: verification, password reset, approval, rejection emails
   - Render env vars updated: RESEND_FROM_EMAIL, FRONTEND_URL

5. **Forgot Password Flow Tested**
   - Full flow working: request ‚Üí email ‚Üí reset form ‚Üí success
   - Emails branded correctly, links go to slabworthy.com

### Issues Encountered & Resolved
- **Browser cached 301 redirect** - Old redirect from slabworthy.com ‚Üí collectioncalc.com was cached. Fixed by disabling cache in DevTools or clearing browser data.
- **Render cache** - Had to "Clear build cache & deploy" to get new auth.py changes live

### Decisions Made
- **Skip username for now** - email + password is sufficient for private beta
- **Two-factor auth** - Added to backlog, TOTP recommended when ready
- **AI support inbox** - Future feature, forwarding to Yahoo works for now

---

## Session 24 Summary (February 3, 2026 - Earlier)

### Completed
1. **Privacy Policy (privacy.html)**
   - Covers: account info (name, email), progressive PII collection, comic images, usage data
   - Third-party services: Cloudflare, Render, Resend, R2, Anthropic (Claude)
   - User rights: access, delete, export, opt-out
   - US-focused (no GDPR popup needed, browser cookie controls sufficient)

2. **Terms of Service (terms.html)**
   - Clear "what we do / what we don't do" sections
   - Added eBay/Whatnot listing generation to capabilities
   - **Prohibited Content section** with zero-tolerance policy
   - CSAM reporting to NCMEC language included
   - Comic publisher trademark acknowledgments (Marvel, DC, Image, etc.)
   - CGC¬Æ/CBCS¬Æ trademark disclaimers
   - Strong liability limitations for grade/value estimates
   - California governing law (appropriate for US-only, bootstrapped)

---

## Session 23 Summary (February 2, 2026)

### Major Wins
1. **FMV Now Uses eBay + Whatnot Data (v4.2)**
   - `/api/sales/fmv` queries BOTH tables
   - ASM #300: 6 Whatnot + 53 eBay = 59 total sales
   - Response includes `sources: { whatnot: X, ebay: Y }`

2. **Reprint Filter (v4.2.1)**
   - `is_reprint = false` filter on both tables
   - Text filters: "reprint", "2nd print", "3rd print", etc.
   - Fixes Spawn #1 valuation pollution

3. **Full Slab Worthy Rebrand**
   - slabworthy.com ‚Üí custom domain on Cloudflare Pages
   - New branding: "Slab Worthy‚Ñ¢ - AI for Comic Collectors"
   - Removed Photo Upload tab
   - Slab Worthy? is now default tab
   - Comic-shaped upload boxes (7:10 cover, 1:6 spine, 14:10 centerfold)
   - Centerfold has dotted center line
   - Desktop: "Upload" text, hidden "Take Photo" button
   - Footer: Contact, Privacy, Terms + "Powered by CollectionCalc‚Ñ¢ ¬© 2026"

---

## Two-Brand Architecture

### CollectionCalc (Backend/API)
- **Role:** "The brain" - infrastructure, API, data
- **Tone:** Professional, expert, measured
- **Audience:** Developers, partners, B2B

### Slab Worthy (Consumer Product)
- **Role:** Fun, approachable consumer brand
- **Tone:** Enthusiastic, knowledgeable, casual
- **Audience:** Comic collectors (35+, 70%+ male, but welcoming to all)
- **Tagline:** "AI for Comic Collectors"
- **Voice:** "Your knowledgeable collector buddy who shoots straight"

### "Worthy" Brand Family (Future)
- **slabworthy.com** ‚Äî Comics (CGC, CBCS) ‚úÖ LIVE
- **psaworthy.com** ‚Äî Cards (PSA, BGS) - future
- **coinworthy.com** ‚Äî Coins (PCGS, NGC) - future

All share CollectionCalc backend. Same pattern:
```
Photo ‚Üí AI Vision ‚Üí Grade Estimate ‚Üí Market Value ‚Üí "Worth grading?"
```

---

## Site Structure

```
slabworthy.com/
‚îú‚îÄ‚îÄ index.html      ‚Üí Marketing homepage (gold logo, How It Works)
‚îú‚îÄ‚îÄ login.html      ‚Üí Auth (beta code, signup, login)
‚îú‚îÄ‚îÄ app.html        ‚Üí Grading tool (logged-in users)
‚îú‚îÄ‚îÄ faq.html        ‚Üí FAQ (10 Q&A items)
‚îú‚îÄ‚îÄ about.html      ‚Üí About page
‚îú‚îÄ‚îÄ pricing.html    ‚Üí Pricing (coming soon placeholder)
‚îú‚îÄ‚îÄ privacy.html    ‚Üí Privacy policy
‚îî‚îÄ‚îÄ terms.html      ‚Üí Terms of service
```

**Header (all pages except login.html):**
- Gold "SLAB WORTHY" logo (links to /)
- "Log In" link

**Footer (all pages except login.html):**
- "Check a Comic" CTA button
- Logo + "Powered by CollectionCalc‚Ñ¢"
- 3 columns: Product (How It Works, Pricing, FAQ), Company (About, Contact), Legal (Privacy, Terms)
- Copyright + trademark disclaimers

---

## Technical Debt

### HTML Duplication (HIGH PRIORITY)
- Header and footer duplicated across 6+ HTML files
- **Solution:** Migrate to 11ty static site generator
- 11ty uses templates with shared layouts, compiles to plain HTML
- Cloudflare Pages supports 11ty builds natively
- Would allow single-file header/footer changes

### wsgi.py Refactoring Needed
- Currently ~1,900 lines and growing
- Recommendation: Split at ~2,500 lines using Flask Blueprints
- Suggested structure:
  - `routes/auth.py` - authentication endpoints
  - `routes/admin.py` - admin/NLQ endpoints  
  - `routes/sales.py` - FMV, market data
  - `routes/images.py` - R2 upload, barcode scanning
  - `routes/grading.py` - extraction, grading endpoints

### Dead Code
- Barcode backfill endpoints (`/api/admin/backfill-barcodes`, `/api/admin/barcode-stats`) - functional but useless since Whatnot images don't have visible barcodes

---

## Content Moderation System (To Build - PRE-BETA MUST-HAVE)

### Architecture
```
User uploads image
    ‚Üì
BEFORE storing/processing:
    ‚Üí Amazon Rekognition (explicit content detection)
    ‚Üí If flagged: block upload, log incident
    ‚Üí If CSAM detected: preserve evidence, report to NCMEC
    ‚Üí If clean: proceed to comic analysis
```

### Setup Steps
1. [ ] Integrate Amazon Rekognition into image upload pipeline
2. [ ] Register for NCMEC CyberTipline ESP account
3. [ ] Apply for PhotoDNA access (Microsoft)
4. [ ] Create `content_incidents` table
5. [ ] Build admin view for reviewing flags
6. [ ] Create incident response procedure document

---

## Analytics & A/B Testing (Post-Beta)

### Recommended Stack: PostHog
- **Why:** All-in-one (analytics + A/B tests + session replay), open source, generous free tier
- **Alternative considered:** Statsig (better stats, but experimentation-only)

### Phases
1. **Phase 1:** PostHog integration - events, funnels, session replay
2. **Phase 2:** Manual A/B tests - taglines, CTAs, pricing
3. **Phase 3:** AI-assisted experimentation via RelevantSee

### Key Events to Track
- `grading_started`, `photo_uploaded`, `grading_completed`
- `grading_abandoned` (with last step)
- `verdict_shown`, `save_to_collection`
- `signup_started`, `signup_completed`

---

## Quick Reference

### Deployment Commands (PowerShell)
```powershell
# Full deploy (backend changes)
git add . ; git commit -m "message" ; git push ; purge ; deploy

# Frontend only (try without deploy first)
git add . ; git commit -m "message" ; git push ; purge
```

### URLs
- **Frontend:** slabworthy.com
- **API:** collectioncalc-docker.onrender.com
- **Service ID:** srv-d5vcjqqli9vc73a5a730

### Email
- **Transactional:** noreply@slabworthy.com (via Resend)
- **Support:** support@slabworthy.com ‚Üí Yahoo (via Cloudflare Email Routing)

### Render Env Vars
- `RESEND_FROM_EMAIL` = `noreply@slabworthy.com`
- `FRONTEND_URL` = `https://slabworthy.com`

### Test Endpoints
```bash
curl https://collectioncalc-docker.onrender.com/health
# Returns: {"barcode":true,"status":"ok","version":"4.2.1"}
```

### Mobile Testing (Chrome DevTools)
1. F12 ‚Üí Click phone icon
2. Select "Pixel 7" from dropdown
3. Test at 412px width

---

*Last updated: February 4, 2026 (Session 27)*
*Version: 4.2.1*
