# Claude Working Notes - CollectionCalc / Slab Worthy Project

## Executive Summary

**Purpose:** This document helps Claude quickly get up to speed when starting a new session with Mike on the Slab Worthy project.

**The Project:** Slab Worthy is an AI-powered comic grading tool. The flagship feature uses patent-pending multi-angle photography to assess whether comics are worth professional grading. Powered by CollectionCalc backend.

**The Human:** Mike is a Product Manager (not a developer). He's comfortable with Git, Render deployments, and SQL queries, but needs guidance on complex debugging and architecture decisions. He wants Claude to push back and share knowledge proactively.

**Working Style Preference:** Mike prefers natural, collaborative conversation over formal business consultant mode. Keep it friendly and conversational - avoid getting too structured/professional even when reviewing project documentation. Think "working on cool stuff together" rather than "client presentation."

**Current State (v4.2.2):**
- **Content moderation LIVE** - AWS Rekognition checks all user-uploaded images
- **All pages now have consistent header/footer** - Gold logo, matching nav and footer
- **Gold Bangers logo on app page** - Matches homepage branding (Session 30)
- **Auth token unified** - login.html and auth.js both use `cc_token` now (Session 30)
- **Auth gate on app page** - Unauthenticated users redirected to /login.html (Session 30)
- **Debug alerts removed** - Production-safe error handling in grading.js (Session 30)
- **Dev mode Quick Test working** - üß™ button runs full mock grading flow (Session 30)
- **Site restructured** - Marketing at /, auth at /login.html
- **Mode toggle hidden** - Slab Worthy is now the only visible mode (Manual Entry hidden)
- **Email system complete** - Resend configured for slabworthy.com (free tier, CC domain removed)
- **Password reset fixed** - Links go to /login.html, 24hr token expiry
- FMV uses eBay + Whatnot data (10x more sales!)
- Reprint filter active (Spawn #1 fix)
- Barcode scanning infrastructure ready
- eBay Collector extension v1.0.3, Whatnot Valuator v2.41.2
- **Known limitation:** Slab premium uses hardcoded formula, not real market data (see backlog)

---

## üö® IMMEDIATE ACTION ITEMS

### Pre-Beta MUST-HAVES
- [x] **Content moderation system** - Amazon Rekognition integration ‚úÖ (v4.2.2, Session 28)
- [ ] **Mobile testing** - IN PROGRESS (Session 30). Auth gate, logo, debug alerts done. Photo rotation, password eye, spine box still need fixing.

### Branding ‚úÖ RESOLVED
- [x] **Tagline decided** - "AI for Comic Collectors"
- [x] **Logo style decided** - Gold comic-style with purple drop shadows (Bangers font)
- [x] **Site structure decided** - Marketing homepage + separate login page
- [x] **Header/footer consistency** - All pages updated (Session 27)

### Backlog
- [ ] **Real slab premium data** - Currently using hardcoded multiplier tiers (getSlabPremium in grading.js). Replace with actual market data by parsing existing eBay sales titles for CGC/CBCS/PGX + grade numbers. Add fields: is_slabbed, slab_company, slab_grade to ebay_sales. Then calculate real per-title slab premiums by comparing raw vs slabbed averages. Big accuracy improvement for the "Should You Slab It?" verdict.
- [ ] **Migrate to 11ty static site generator** - Shared header/footer templates instead of duplicating HTML across pages. Also consolidate logo into single template/component (currently duplicated as inline HTML on every page). Cloudflare Pages supports 11ty natively. Free and open source. Would make future updates much easier.
- [ ] **eBay extension: background sync** - Currently sync runs in popup.js, dies if popup closes. Move sync logic to background service worker so it keeps running after clicking away. Big QOL improvement ‚Äî Mike runs 34 searches/day manually. Could also explore auto-scheduling searches.
- [ ] **"Remember me" / persistent login** - Default to short session (24hr), full 30-day token only if user checks "Keep me logged in"
- [ ] **Two-factor authentication** - TOTP (authenticator app) recommended
- [ ] **AI-powered support inbox** - Route support@slabworthy.com through Claude for auto-responses
- [ ] **PostHog integration** - Analytics, A/B tests, session replay (post-beta)
- [ ] **Pricing page content** - Need to finalize pricing model

---

## Session 30 Summary (February 5, 2026)

### Major Accomplishments

1. **Dev Mode Quick Test ‚Äî FIXED ‚úÖ**
   - Root cause: `runQuickTest()` called `setMode('grading')` which targeted DOM elements that don't exist
   - Fix: Removed `setMode` call (unnecessary ‚Äî user is already on grading tab), added step 5 activation logic, populated mock grade data (ASM #300, 8.0 VF)
   - Full flow now works: mock grade ‚Üí defects ‚Üí cache warning ‚Üí valuation ‚Üí verdict
   - **Gotcha:** grading.js lives in `js/` folder ‚Äî first push went to repo root and didn't take effect

2. **Gold Bangers Logo on App Page ‚úÖ**
   - Added Bangers font import to app.html
   - Styled header h1 with gold `#facc15` + purple text-shadow
   - Had to override `styles.css` global h1 rule that used `-webkit-text-fill-color: transparent` with `background-clip: text` for gradient effect ‚Äî this always beats `color` even with `!important`
   - Fix: explicit `-webkit-text-fill-color: #facc15 !important` + `background: none !important`
   - Uppercase "SLAB WORTHY" with superscript ‚Ñ¢ to match homepage

3. **Auth Token Key Mismatch ‚Äî FIXED ‚úÖ**
   - **Root cause:** `login.html` stored token as `cc_token`, `auth.js` looked for `cc_auth_token` ‚Äî they never found each other
   - Unified everything on `cc_token` (login.html's key, since that's the primary login page)
   - Files updated: `auth.js`, `app.html` auth gate

4. **Auth Gate on App Page ‚úÖ**
   - Inline script at top of app.html checks `localStorage.getItem('cc_token')`
   - No token ‚Üí immediate `window.location.replace('/login.html')`
   - Runs before any other scripts load ‚Äî unauthenticated users never see the grading UI

5. **Debug Alerts Removed ‚úÖ**
   - 4 `alert('DEBUG ...')` calls in grading.js replaced with `console.error()`
   - No-auth check now redirects to login instead of alerting
   - User-facing alerts kept ("Save to collection coming soon!", "No grade data to save")

6. **Mode Toggle Hidden ‚úÖ**
   - "Slab Worthy‚Ñ¢? / Manual Entry" toggle bar hidden with `display: none`
   - HTML kept intact so `setMode()` in app.js doesn't throw null errors
   - Users now go straight from header to step 1

7. **"Should You Slab It?" Heading Cleaned Up ‚úÖ**
   - Removed "| Slab Worthy‚Ñ¢" ‚Äî just says "Should You Slab It?" now

8. **Homepage ‚Ñ¢ Added ‚úÖ**
   - Main hero logo: `SLAB WORTHY‚Ñ¢` (superscript span)
   - Footer logo: `SLAB WORTHY‚Ñ¢`

### Bugs Found During Mobile Testing (IN PROGRESS)
- [ ] **App page logo still purple** ‚Äî Gold override deployed but may need verification. The `-webkit-text-fill-color` fix was deployed but last screenshot still showed purple/blue. May need hard refresh or further CSS specificity work.
- [ ] **Password eye icon** ‚Äî not native, only shows via browser extension. Need to add toggle to login.html (login.html already has `togglePassword()` function ‚Äî may just need visible button in HTML)
- [ ] **Photo rotation on mobile** ‚Äî images display upside down. EXIF orientation handling may not be working
- [ ] **Spine upload box** ‚Äî icon misaligned. Idea: comic diagram that highlights current area per step (reuse homepage icon)
- [ ] **Micronauts #6** ‚Äî "could not retrieve market values" ‚Äî may be Render cold start / no sales data
- [ ] **Login page** ‚Äî replace "‚Üê Home" link with gold Bangers logo linking to /
- [ ] **"Remember me" checkbox** ‚Äî on login page, short session default, 30-day if checked

### ‚ö†Ô∏è IMPORTANT: Token Key Reference
All frontend files MUST use `cc_token` for localStorage:
- `login.html` ‚Äî stores `cc_token` ‚úÖ
- `auth.js` ‚Äî reads/stores `cc_token` ‚úÖ (was `cc_auth_token`, fixed Session 30)
- `app.html` auth gate ‚Äî checks `cc_token` ‚úÖ
- If any other file touches auth tokens, verify it uses `cc_token`

### Files Updated This Session
- `app.html` ‚Äî Gold Bangers logo, auth gate, mode toggle hidden, "Should You Slab It?" heading
- `js/grading.js` ‚Äî Quick Test fix, debug alerts removed (**NOTE: lives in js/ folder, not repo root**)
- `js/auth.js` ‚Äî Token key unified to `cc_token`
- `index.html` ‚Äî ‚Ñ¢ added to hero logo and footer logo

### Next Session Priorities (When Mike Returns)
1. **Continue mobile testing** ‚Äî Mike was mid-walkthrough
2. **Fix remaining mobile bugs** (photo rotation, password eye, spine box, login page logo)
3. **Remember me checkbox** on login
4. **Investigate Micronauts #6 valuation failure**
5. **Ron's login debugging** ‚Äî may be resolved by token key fix

---

## Session 29 Summary (February 5, 2026)

### Major Accomplishments

1. **Trademark Protection Deployed ‚úÖ**
   - Added ‚Ñ¢ symbol across entire site (app.html, Brand Guidelines v2.1)
   - HTML entity: `&trade;` for proper display
   - Locations: page titles, buttons, headers, product names
   - Establishes legal claim to "Slab Worthy" trademark

2. **Trademark Research - Conflict Resolved ‚úÖ**
   - Canadian eBay seller "mig9976" investigated thoroughly
   - Zero commercial use of "Slab Worthy" found in their business
   - Different territory (Canada vs US) reduces risk further
   - Clear path for US trademark filing when budget approved

3. **Cache Warning System - Backend Complete ‚úÖ**
   - `/api/cache/check` endpoint working properly
   - Uses correct database structure: `search_cache` table, `search_key` column format `title|issue`
   - 48-hour cache expiry logic
   - Returns `{success, cached: boolean, lastChecked: timestamp}`

4. **Cache Warning System - Frontend Complete ‚úÖ**
   - Amber-colored warning component with slab+? SVG icon
   - Shows when comic hasn't been checked recently
   - **Key improvement:** Persists during entire valuation process (not 4-second dismiss)
   - Auto-hides when recommendation appears
   - CSS styling matches brand (amber `#d97706` + purple theme)

5. **Dev Mode Testing Framework ‚úÖ**
   - Activated with `?dev` URL parameter or localhost
   - Green üß™ "Quick Test" button appears in top-right
   - **Status:** Detection and button creation working
   - **Issue:** DOM element targeting errors when clicked (needs 15min fix next session)

6. **USPTO Trademark Research Session**
   - Navigated government website redirect loops successfully
   - Confirmed filing costs: TEAS Plus ($250) vs TEAS Standard ($350) 
   - Mike has existing USPTO account from patent filing
   - Ready to file when CFO approves budget

### Brand Guidelines Updated
- Version bumped to v2.1 
- New trademark usage section added
- Specifies where/how to use ‚Ñ¢ symbol
- Standard footer trademark notice template

### Current Status - Pre-Beta Checklist
- [x] **Content moderation** - Live with AWS Rekognition
- [x] **Trademark protection** - ‚Ñ¢ symbols deployed (homepage added Session 30)
- [x] **Cache warning system** - Complete and tested via Quick Test
- [x] **Shimmer effects** - Live during thinking animations  
- [x] **Dev mode fixes** - Quick Test working ‚úÖ (Session 30)
- [x] **Auth gate** - Unauthenticated users redirected ‚úÖ (Session 30)
- [x] **Debug alerts removed** - Production-safe ‚úÖ (Session 30)
- [ ] **Mobile testing** - IN PROGRESS (Session 30)

### Files Deployed This Session
- `app.html` - ‚Ñ¢ symbols added to page title, buttons, headers
- `grading.js` - Cache warning logic + dev mode framework  
- `styles.css` - Cache warning component styling
- `wsgi.py` - `/api/cache/check` endpoint
- `BRAND_GUIDELINES.md` - v2.1 with trademark usage section

### Next Session Priorities
1. **Fix dev mode DOM targeting** - Identify correct element IDs for quick test
2. **Test cache warning end-to-end** - Validate full flow works
3. **Mobile testing** or **Ron's login debugging** (he had redirect issues)

---

## Session 28 Summary (February 4-5, 2026)

### Major Accomplishments

1. **Content Moderation LIVE (v4.2.2)**
   - AWS Rekognition integrated into image upload pipeline
   - Checks run BEFORE images are processed or stored
   - Blocks: explicit nudity, graphic violence, drugs, hate symbols
   - Warns but allows: suggestive content, mild violence (comics can be edgy)
   - `content_incidents` table logs all flagged images
   - Admin endpoint: `/api/admin/moderation`
   - Graceful degradation: if Rekognition goes down, images pass through
   - New file: `content_moderation.py`

2. **Password Reset Bug Fixed**
   - Reset email links were pointing to `slabworthy.com/` (marketing page) instead of `/login.html`
   - Fixed in auth.py: both verification and reset URLs now include `/login.html`
   - Added friendlier "check your inbox" message after submitting forgot password
   - Extended token expiry from 1 hour to 24 hours

3. **AWS Account Created**
   - IAM user: `Slabworthy` with `AmazonRekognitionReadOnlyAccess`
   - Render env vars: AWS_ACCESS_KEY_ID, AWS_SECRET_ACCESS_KEY, AWS_REGION=us-west-2
   - Free tier: 5,000 images/month for 12 months

4. **Resend Downgraded**
   - Removed CollectionCalc domain from Resend
   - Downgraded to free tier ($0/mo) ‚Äî saves $240/year
   - Only slabworthy.com domain needed

5. **Slab Premium Analysis**
   - Current model: hardcoded tiered multipliers in `getSlabPremium()` (grading.js line 1265)
   - Weaknesses: ignores grade (9.8 vs 6.0 have wildly different premiums), ignores title, static formula
   - `getGradingCost()` also simplified (4 tiers: $30/$50/$85/$150)
   - Plan: Parse existing eBay sales titles for CGC/CBCS/PGX + grade, tag with is_slabbed/slab_company/slab_grade, then calculate real per-title premiums
   - ~3 sessions to implement, needs time to accumulate data after build
   - NOT blocking beta ‚Äî current formula is reasonable placeholder

6. **Beta Tester (Ron) - Password Reset Issue**
   - midwestron@gmail.com couldn't reset password
   - Root cause: email links pointed to index.html (marketing) not login.html (auth)
   - Fixed in auth.py, token expired before he could use it ‚Üí extended to 24hr

### AWS Account Details
- Account ID: 682714859313
- IAM user: Slabworthy (AmazonRekognitionReadOnlyAccess)
- Region: us-west-2
- Free tier: 5,000 Rekognition images/month for 12 months

### Files Updated/Created
- `content_moderation.py` ‚Äî NEW: Rekognition wrapper + incident logging
- `content_incidents.sql` ‚Äî NEW: Database table for moderation logs
- `wsgi.py` ‚Äî Moderation integrated into /api/extract, /api/messages, /api/images/submission
- `auth.py` ‚Äî Fixed email URLs, extended reset token to 24hr
- `login.html` ‚Äî Friendlier forgot password message
- `requirements.txt` ‚Äî Added boto3

### Endpoints Protected by Moderation
- `/api/extract` ‚Äî comic photo analysis
- `/api/messages` ‚Äî Anthropic proxy (checks images in message content)
- `/api/images/submission` ‚Äî B4Cert image uploads

---

## Session 27 Summary (February 4, 2026)

### Major Accomplishments

1. **Header/Footer Consistency Across All Pages**
   - Updated: pricing.html, about.html, faq.html, terms.html, privacy.html
   - Header: Gold "SLAB WORTHY" logo + "Log In" link (removed "How It Works")
   - Footer: CTA button + logo with tagline + 3-column links (Product, Company, Legal)

2. **Terms & Privacy Pages Restyled**
   - Changed from old indigo gradient to gold/purple brand colors
   - Added Bangers font for logo
   - Consistent with rest of site

3. **Identified Technical Debt: Duplicate HTML**
   - Current pain point: Changing header/footer requires editing 6+ files
   - Solution: Migrate to 11ty static site generator
   - Added to backlog for future session

### Files Updated This Session
- `/pricing.html` - New header/footer
- `/about.html` - New header/footer  
- `/faq.html` - New header/footer
- `/terms.html` - New header/footer + gold logo styling
- `/privacy.html` - New header/footer + gold logo styling
- `CLAUDE_NOTES.txt` - This file

---

## Session 26 Summary (February 4, 2026)

### Major Accomplishments

1. **New Marketing Homepage Deployed**
   - Gold comic-style logo (Bangers font) with purple text-shadow
   - Tagline: "AI for Comic Collectors"
   - "How It Works" scrollytelling section (4 steps, always vertical)
   - Mobile responsive design
   - CTA buttons link to /login.html

2. **Site Restructure**
   - `index.html` ‚Üí New marketing homepage
   - `login.html` ‚Üí Auth page (moved from old index.html)
   - Login page updated: gold logo, removed feature cards, added "‚Üê Home" link

3. **New Pages Deployed**
   - `faq.html` - 10 expandable Q&A items
   - `about.html` - Problem/solution story, values grid, patent mention
   - `pricing.html` - "Coming soon" placeholder with beta note

4. **Logo Clipping Bug Fixed**
   - **Problem:** `background-clip: text` with gradient caused "Y" descender to be cut off
   - **Solution:** Use solid gold color (`#facc15`) with `text-shadow` instead
   - **CSS:** `color: #facc15; text-shadow: 2px 2px 0 #7c3aed, 4px 4px 0 #1e1b4b;`
   - Applied fix to: index.html, login.html, faq.html, about.html, pricing.html

5. **First Beta Testers!**
   - Beta codes in database: BETA-001 through BETA-005 (1 use each)
   - BETA-MIKE already used (Mike's account)
   - Give testers codes like `BETA-001`, `BETA-002`

### Technical Lessons Learned
- `background-clip: text` + gradient clips to text bounding box, cuts off descenders (y, g, p, q)
- `text-shadow` works reliably for comic-style shadow effects
- `filter: drop-shadow` also has clipping issues with text gradients
- PowerShell uses `Copy-Item` not `cp`, semicolons not `&&`

---

## Session 25 Summary (February 3, 2026 - Evening)

### Completed
1. **Privacy & Terms Deployed**
   - privacy.html and terms.html pushed to Cloudflare Pages
   - Accessible at slabworthy.com/privacy.html and slabworthy.com/terms.html

2. **Resend Configured for slabworthy.com**
   - Added domain to existing Resend account
   - Cloudflare auto-configured DNS records (DKIM, SPF, MX)
   - All records verified ‚úÖ

3. **Email Routing Set Up**
   - support@slabworthy.com ‚Üí forwards to Mike's Yahoo
   - Using Cloudflare Email Routing (not Resend receiving)
   - AI-powered inbox routing is future feature

4. **Email Templates Rebranded**
   - Updated auth.py: all emails now say "Slab Worthy" instead of "CollectionCalc"
   - From address: noreply@slabworthy.com
   - Updated: verification, password reset, approval, rejection emails
   - Render env vars updated: RESEND_FROM_EMAIL, FRONTEND_URL

5. **Forgot Password Flow Tested**
   - Full flow working: request ‚Üí email ‚Üí reset form ‚Üí success
   - Emails branded correctly, links go to slabworthy.com

### Issues Encountered & Resolved
- **Browser cached 301 redirect** - Old redirect from slabworthy.com ‚Üí collectioncalc.com was cached. Fixed by disabling cache in DevTools or clearing browser data.
- **Render cache** - Had to "Clear build cache & deploy" to get new auth.py changes live

### Decisions Made
- **Skip username for now** - email + password is sufficient for private beta
- **Two-factor auth** - Added to backlog, TOTP recommended when ready
- **AI support inbox** - Future feature, forwarding to Yahoo works for now

---

## Session 24 Summary (February 3, 2026 - Earlier)

### Completed
1. **Privacy Policy (privacy.html)**
   - Covers: account info (name, email), progressive PII collection, comic images, usage data
   - Third-party services: Cloudflare, Render, Resend, R2, Anthropic (Claude)
   - User rights: access, delete, export, opt-out
   - US-focused (no GDPR popup needed, browser cookie controls sufficient)

2. **Terms of Service (terms.html)**
   - Clear "what we do / what we don't do" sections
   - Added eBay/Whatnot listing generation to capabilities
   - **Prohibited Content section** with zero-tolerance policy
   - CSAM reporting to NCMEC language included
   - Comic publisher trademark acknowledgments (Marvel, DC, Image, etc.)
   - CGC¬Æ/CBCS¬Æ trademark disclaimers
   - Strong liability limitations for grade/value estimates
   - California governing law (appropriate for US-only, bootstrapped)

---

## Session 23 Summary (February 2, 2026)

### Major Wins
1. **FMV Now Uses eBay + Whatnot Data (v4.2)**
   - `/api/sales/fmv` queries BOTH tables
   - ASM #300: 6 Whatnot + 53 eBay = 59 total sales
   - Response includes `sources: { whatnot: X, ebay: Y }`

2. **Reprint Filter (v4.2.1)**
   - `is_reprint = false` filter on both tables
   - Text filters: "reprint", "2nd print", "3rd print", etc.
   - Fixes Spawn #1 valuation pollution

3. **Full Slab Worthy Rebrand**
   - slabworthy.com ‚Üí custom domain on Cloudflare Pages
   - New branding: "Slab Worthy‚Ñ¢ - AI for Comic Collectors"
   - Removed Photo Upload tab
   - Slab Worthy? is now default tab
   - Comic-shaped upload boxes (7:10 cover, 1:6 spine, 14:10 centerfold)
   - Centerfold has dotted center line
   - Desktop: "Upload" text, hidden "Take Photo" button
   - Footer: Contact, Privacy, Terms + "Powered by CollectionCalc‚Ñ¢ ¬© 2026"

---

## Two-Brand Architecture

### CollectionCalc (Backend/API)
- **Role:** "The brain" - infrastructure, API, data
- **Tone:** Professional, expert, measured
- **Audience:** Developers, partners, B2B

### Slab Worthy (Consumer Product)
- **Role:** Fun, approachable consumer brand
- **Tone:** Enthusiastic, knowledgeable, casual
- **Audience:** Comic collectors (35+, 70%+ male, but welcoming to all)
- **Tagline:** "AI for Comic Collectors"
- **Voice:** "Your knowledgeable collector buddy who shoots straight"

### "Worthy" Brand Family (Future)
- **slabworthy.com** ‚Äî Comics (CGC, CBCS) ‚úÖ LIVE
- **psaworthy.com** ‚Äî Cards (PSA, BGS) - future
- **coinworthy.com** ‚Äî Coins (PCGS, NGC) - future

All share CollectionCalc backend. Same pattern:
```
Photo ‚Üí AI Vision ‚Üí Grade Estimate ‚Üí Market Value ‚Üí "Worth grading?"
```

---

## Site Structure

```
slabworthy.com/
‚îú‚îÄ‚îÄ index.html      ‚Üí Marketing homepage (gold logo, How It Works)
‚îú‚îÄ‚îÄ login.html      ‚Üí Auth (beta code, signup, login)
‚îú‚îÄ‚îÄ app.html        ‚Üí Grading tool (logged-in users)
‚îú‚îÄ‚îÄ faq.html        ‚Üí FAQ (10 Q&A items)
‚îú‚îÄ‚îÄ about.html      ‚Üí About page
‚îú‚îÄ‚îÄ pricing.html    ‚Üí Pricing (coming soon placeholder)
‚îú‚îÄ‚îÄ privacy.html    ‚Üí Privacy policy
‚îî‚îÄ‚îÄ terms.html      ‚Üí Terms of service
```

**Header (all pages except login.html):**
- Gold "SLAB WORTHY" logo (links to /)
- "Log In" link

**Footer (all pages except login.html):**
- "Check a Comic" CTA button
- Logo + "Powered by CollectionCalc‚Ñ¢"
- 3 columns: Product (How It Works, Pricing, FAQ), Company (About, Contact), Legal (Privacy, Terms)
- Copyright + trademark disclaimers

---

## Technical Debt

### HTML Duplication (HIGH PRIORITY)
- Header and footer duplicated across 6+ HTML files
- **Solution:** Migrate to 11ty static site generator
- 11ty uses templates with shared layouts, compiles to plain HTML
- Cloudflare Pages supports 11ty builds natively
- Would allow single-file header/footer changes

### wsgi.py Refactoring Needed
- Currently ~1,900 lines and growing
- Recommendation: Split at ~2,500 lines using Flask Blueprints
- Suggested structure:
  - `routes/auth.py` - authentication endpoints
  - `routes/admin.py` - admin/NLQ endpoints  
  - `routes/sales.py` - FMV, market data
  - `routes/images.py` - R2 upload, barcode scanning
  - `routes/grading.py` - extraction, grading endpoints

### Dead Code
- Barcode backfill endpoints (`/api/admin/backfill-barcodes`, `/api/admin/barcode-stats`) - functional but useless since Whatnot images don't have visible barcodes

---

## Content Moderation System (To Build - PRE-BETA MUST-HAVE)

### Architecture
```
User uploads image
    ‚Üì
BEFORE storing/processing:
    ‚Üí Amazon Rekognition (explicit content detection)
    ‚Üí If flagged: block upload, log incident
    ‚Üí If CSAM detected: preserve evidence, report to NCMEC
    ‚Üí If clean: proceed to comic analysis
```

### Setup Steps
1. [ ] Integrate Amazon Rekognition into image upload pipeline
2. [ ] Register for NCMEC CyberTipline ESP account
3. [ ] Apply for PhotoDNA access (Microsoft)
4. [ ] Create `content_incidents` table
5. [ ] Build admin view for reviewing flags
6. [ ] Create incident response procedure document

---

## Analytics & A/B Testing (Post-Beta)

### Recommended Stack: PostHog
- **Why:** All-in-one (analytics + A/B tests + session replay), open source, generous free tier
- **Alternative considered:** Statsig (better stats, but experimentation-only)

### Phases
1. **Phase 1:** PostHog integration - events, funnels, session replay
2. **Phase 2:** Manual A/B tests - taglines, CTAs, pricing
3. **Phase 3:** AI-assisted experimentation via RelevantSee

### Key Events to Track
- `grading_started`, `photo_uploaded`, `grading_completed`
- `grading_abandoned` (with last step)
- `verdict_shown`, `save_to_collection`
- `signup_started`, `signup_completed`

---

## Quick Reference

### Deployment Commands (PowerShell)
```powershell
# Full deploy (backend changes)
git add . ; git commit -m "message" ; git push ; purge ; deploy

# Frontend only (try without deploy first)
git add . ; git commit -m "message" ; git push ; purge
```

### URLs
- **Frontend:** slabworthy.com
- **API:** collectioncalc-docker.onrender.com
- **Service ID:** srv-d5vcjqqli9vc73a5a730

### Email
- **Transactional:** noreply@slabworthy.com (via Resend)
- **Support:** support@slabworthy.com ‚Üí Yahoo (via Cloudflare Email Routing)

### Render Env Vars
- `RESEND_FROM_EMAIL` = `noreply@slabworthy.com`
- `FRONTEND_URL` = `https://slabworthy.com`

### Test Endpoints
```bash
curl https://collectioncalc-docker.onrender.com/health
# Returns: {"barcode":true,"moderation":true,"status":"ok","version":"4.2.2"}
```

### Mobile Testing (Chrome DevTools)
1. F12 ‚Üí Click phone icon
2. Select "Pixel 7" from dropdown
3. Test at 412px width

---

*Last updated: February 5, 2026 (Session 30)*
*Version: 4.2.2*
