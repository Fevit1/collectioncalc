# Claude Working Notes - CollectionCalc Project

## Executive Summary

**Purpose:** This document helps Claude quickly get up to speed when starting a new session with Mike on the CollectionCalc project.

**The Project:** CollectionCalc is an AI-powered comic book valuation tool. The flagship feature "Slab Worthy?" uses patent-pending multi-angle photography to assess whether comics are worth professional grading.

**The Human:** Mike is a Product Manager (not a developer). He's comfortable with Git, Render deployments, and SQL queries, but needs guidance on complex debugging and architecture decisions. He wants Claude to push back and share knowledge proactively.

**Current State (v4.2.1):**
- Core features working: Manual Entry, Photo Upload, Slab Worthy
- **ðŸŽ‰ BARCODE SCANNING LIVE** â€” Docker deployment with pyzbar/libzbar0
- **ðŸŽ‰ FMV NOW USES EBAY + WHATNOT DATA** â€” 10x more sales data!
- **ðŸŽ‰ REPRINT FILTER ACTIVE** â€” Spawn #1 problem fixed!
- eBay Collector extension v1.0.3, Whatnot Valuator v2.41.2

**Next Priority:** Complete slabworthy.com redirect (waiting for DNS propagation)

---

## Session 23 Summary (February 2, 2026)

### ðŸŽ‰ BIG WINS

**1. FMV Now Uses eBay + Whatnot Data (v4.2)**
- `/api/sales/fmv` queries BOTH `market_sales` AND `ebay_sales`
- ASM #300 example: 6 Whatnot + 53 eBay = **59 total sales** (was just 6!)
- eBay filters: no facsimiles, lots, bundles, or <$5 sales
- Response includes `sources: { whatnot: X, ebay: Y }`

**2. Reprint Filter (v4.2.1)**
- `is_reprint = false` filter on both tables
- Text filters: "reprint", "2nd print", "3rd print", "4th print"
- **Fixes Spawn #1 problem** â€” 2nd prints won't pollute 1st print valuations

**3. Slab Worthy Domain Setup (In Progress)**
- slabworthy.com added to Cloudflare
- Nameservers updated at Network Solutions
- **Waiting for DNS propagation**
- Next: Add redirect rule â†’ collectioncalc.com/app.html#slab

### Business Vision Discussed
Mike's plan: "Worthy" brand family
- **slabworthy.com** â€” Comics (CGC, CBCS)
- **coinworthy.com** â€” Coins (PCGS, NGC)
- **cardworthy.com** â€” Cards (PSA, BGS)
- All share one backend (collectioncalc-api)
- Same pattern: Photo â†’ AI Vision â†’ Grade â†’ Value â†’ "Worth grading?"

### Other Fixes
- Fixed deploy command (Render API key format)
- Fixed index.html typo (`collectioncal-docker` â†’ `collectioncalc-docker`)
- Disabled auto-deploy in Render (was causing duplicate deploys)
- Thinking animation in Slab Worthy Step 5 â€” already working! âœ…

### Barcode Backfill â€” Skipped
- Added endpoints but Whatnot images don't show barcodes
- Live stream screenshots, barcode corner cropped out
- Will be useful for: Slab Worthy photos, eBay Collector images

---

## Quick Reference

### Deployment Commands
```powershell
# Backend (Render Docker) - auto-deploy OFF, use API
git add .; git commit -m "message"; git push; deploy

# Frontend (Cloudflare)
git add .; git commit -m "message"; git push; purge
```

### Service IDs
- Docker service: `srv-d5vcjqqli9vc73a5a730`
- API URL: `https://collectioncalc-docker.onrender.com`

### Test Endpoints
```bash
# Health check
curl https://collectioncalc-docker.onrender.com/health
# Returns: {"barcode":true,"status":"ok","version":"4.2.1"}

# FMV with sources
curl "https://collectioncalc-docker.onrender.com/api/sales/fmv?title=spider-man&issue=300"
```

### PowerShell Profile
Location: `C:\Users\mberr\OneDrive\Documents\WindowsPowerShell\Microsoft.PowerShell_profile.ps1`

Needs environment variables:
- `RENDER_API_KEY` â€” For deploy command
- `CLOUDFLARE_ZONE_ID` â€” For purge command
- `CLOUDFLARE_API_TOKEN` â€” For purge command

---

## Pending Tasks

### When DNS Propagates (slabworthy.com)
1. Check: `nslookup slabworthy.com` (should show Cloudflare IPs)
2. Cloudflare Dashboard â†’ slabworthy.com â†’ Rules â†’ Redirect Rules
3. Create rule:
   - Name: `Redirect to Slab Worthy`
   - When: All incoming requests
   - Type: Static
   - URL: `https://collectioncalc.com/app.html#slab`
   - Status: 301

---

## Key Learnings

### eBay Data Quality
- 2,805 sales, 2,615 unique titles
- Needs filtering: facsimiles, lots, bundles, reprints
- Grade field often NULL (only 45 graded sales)
- Still valuable for raw comic pricing

### API URL Locations (Watch for typos!)
- `js/utils.js` â€” Main API_URL constant
- `index.html` â€” Login page (has its own script)
- Extensions have their own API URLs

---

*Last updated: February 2, 2026 (Session 23)*
*Version: 4.2.1*
*Next: Complete slabworthy.com redirect*
