<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CollectionCalc - AI-Powered Collectible Valuation</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <div class="header-brand">
                <h1>CollectionCalc</h1>
                <p class="subtitle">AI-Powered Collectible Valuation</p>
            </div>
            <div class="header-auth" id="headerAuth">
                <!-- Logged out state -->
                <div id="authLoggedOut">
                    <button class="auth-btn auth-btn-login" onclick="openAuthModal('login')">Log In</button>
                    <button class="auth-btn auth-btn-signup" onclick="openAuthModal('signup')">Sign Up</button>
                </div>
                <!-- Logged in state -->
                <div id="authLoggedIn" style="display: none;">
                    <button class="save-collection-btn" onclick="showCollection()" title="My Collection">
                        üìö My Collection
                    </button>
                    <div class="user-menu">
                        <button class="user-menu-btn" onclick="toggleUserMenu()">
                            <div class="user-avatar" id="userAvatar">?</div>
                            <span id="userEmail">user@email.com</span>
                            <span>‚ñæ</span>
                        </button>
                        <div class="user-menu-dropdown" id="userMenuDropdown">
                            <button class="user-menu-item" onclick="showCollection()">üìö My Collection</button>
                            <div class="user-menu-divider"></div>
                            <button class="user-menu-item danger" onclick="logout()">Log Out</button>
                        </div>
                    </div>
                </div>
            </div>
        </header>
        
        <div id="mainApp">
            <div class="mode-toggle">
                <button class="mode-btn active" id="modeManual" onclick="setMode('manual')">‚úèÔ∏è Manual Entry</button>
                <button class="mode-btn" id="modePhoto" onclick="setMode('photo')">üì∏ Photo Upload</button>
            </div>
            
            <div class="card">
                <!-- Manual Entry Mode -->
                <div id="manualMode">
                    <form id="valuationForm">
                        <div class="form-group">
                            <label for="title">Comic Title</label>
                            <input type="text" id="title" placeholder="e.g. Amazing Spider-Man (or ASM)" required>
                        </div>
                        <div class="row">
                            <div class="form-group">
                                <label for="issue">Issue #</label>
                                <input type="text" id="issue" placeholder="e.g. 300" required>
                            </div>
                            <div class="form-group">
                                <label for="grade">Grade</label>
                                <select id="grade">
                                    <option value="NM">Near Mint (NM)</option>
                                    <option value="VF" selected>Very Fine (VF)</option>
                                    <option value="FN">Fine (FN)</option>
                                    <option value="VG">Very Good (VG)</option>
                                    <option value="G">Good (G)</option>
                                    <option value="FR">Fair (FR)</option>
                                    <option value="PR">Poor (PR)</option>
                                </select>
                            </div>
                        </div>
                        <button type="submit" id="submitBtn">Get Valuation</button>
                    </form>
                </div>
                
                <!-- Photo Upload Mode -->
                <div id="photoMode" style="display: none;">
                    <div class="upload-area" id="uploadArea" onclick="document.getElementById('photoInput').click();">
                        <input type="file" id="photoInput" class="upload-input" accept=".jpg,.jpeg,.png,.webp,.heic" multiple onchange="handlePhotoUpload(this.files)">
                        <div class="upload-icon">üì∏</div>
                        <div class="upload-title">Click to upload or drag & drop</div>
                        <div class="upload-subtitle">Select one or multiple comic photos</div>
                    </div>
                </div>
                
                <!-- Bulk Extracted Items -->
                <div id="bulkMode" style="display: none;">
                    <div class="progress-container" id="progressContainer" style="display: none;">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                        </div>
                        <div class="progress-text" id="progressText">Calculating...</div>
                    </div>
                    
                    <div id="itemsList"></div>
                    
                    <div class="action-buttons">
                        <button type="button" class="btn-secondary" onclick="resetToPhoto()">‚Üê Add More Photos</button>
                        <button type="button" id="valuateAllBtn" onclick="valuateAll()">Get All Valuations</button>
                    </div>
                </div>
                
                <!-- Results Summary (for bulk) -->
                <div id="resultsMode" style="display: none;">
                    <div class="summary-card">
                        <div class="result-label">Total Collection Value</div>
                        <div class="summary-total" id="totalValue">$0.00</div>
                        <div class="summary-count" id="itemCount">0 items valued</div>
                    </div>
                    
                    <div class="sort-controls">
                        <label for="sortSelect">Sort by:</label>
                        <select id="sortSelect" onchange="sortResults(this.value)">
                            <option value="default">Order Added</option>
                            <option value="value-high">Value (High to Low)</option>
                            <option value="value-low">Value (Low to High)</option>
                            <option value="title">Title (A-Z)</option>
                        </select>
                    </div>
                    
                    <div id="resultsList"></div>
                    
                    <div class="action-buttons">
                        <button type="button" class="btn-secondary" onclick="resetApp()">‚Üê Start Over</button>
                        <button type="button" onclick="downloadExcel()">üì• Download Excel</button>
                        <button type="button" class="save-collection-btn" onclick="saveAllToCollection()" id="saveCollectionBtn">
                            üíæ Save to Collection
                        </button>
                    </div>
                </div>
                
                <!-- Single Result (for manual entry) -->
                <div class="result" id="result">
                    <div class="result-card" id="resultCard">
                        <div id="resultContent"></div>
                    </div>
                    <div class="action-buttons" style="margin-top: 20px;">
                        <button type="button" class="btn-secondary" onclick="resetApp()">‚Üê Value Another</button>
                    </div>
                </div>
                
                <!-- Thinking Animation -->
                <div class="thinking" id="thinking">
                    <div class="thinking-header">
                        <div class="thinking-calc">
                            <svg viewBox="0 0 32 32" fill="none">
                                <rect x="4" y="2" width="24" height="28" rx="3" stroke="url(#calcGrad)" stroke-width="2.5" fill="none"/>
                                <rect x="7" y="5" width="18" height="7" rx="1" fill="#0f0f1a" stroke="var(--brand-indigo)" stroke-width="1"/>
                                <g clip-path="url(#displayClip)">
                                    <text x="9" y="10.5" class="calc-display calc-num1">$1,247</text>
                                </g>
                                <rect class="calc-btn1" x="7" y="15" width="4" height="3" rx="0.5" fill="var(--brand-indigo)"/>
                                <rect class="calc-btn2" x="14" y="15" width="4" height="3" rx="0.5" fill="var(--brand-indigo)"/>
                                <rect class="calc-btn3" x="21" y="15" width="4" height="3" rx="0.5" fill="var(--brand-purple)"/>
                                <rect class="calc-btn4" x="7" y="20" width="4" height="3" rx="0.5" fill="var(--brand-indigo)"/>
                                <rect class="calc-btn5" x="14" y="20" width="4" height="3" rx="0.5" fill="var(--brand-indigo)"/>
                                <rect class="calc-btn6" x="21" y="20" width="4" height="3" rx="0.5" fill="var(--brand-cyan)"/>
                                <defs>
                                    <linearGradient id="calcGrad" x1="4" y1="2" x2="28" y2="30" gradientUnits="userSpaceOnUse">
                                        <stop stop-color="#4f46e5"/><stop offset="1" stop-color="#7c3aed"/>
                                    </linearGradient>
                                    <clipPath id="displayClip"><rect x="7" y="5" width="18" height="7"/></clipPath>
                                </defs>
                            </svg>
                        </div>
                        <span class="thinking-title" id="thinkingTitle">Calculating...</span>
                    </div>
                    <div class="thinking-steps">
                        <div class="thinking-step pending" id="step1"><span class="icon"></span><span id="step1Text">Checking database for matches</span></div>
                        <div class="thinking-step pending" id="step2"><span class="icon"></span><span id="step2Text">Searching market data</span></div>
                        <div class="thinking-step pending" id="step3"><span class="icon"></span><span id="step3Text">Crunching the numbers</span></div>
                        <div class="thinking-step pending" id="step4"><span class="icon"></span><span id="step4Text">Calculating confidence score</span></div>
                        <div class="thinking-step pending" id="step5"><span class="icon"></span><span id="step5Text">Generating valuation</span></div>
                    </div>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn-secondary btn-small" onclick="changeApiKey()">üîë Change API Key</button>
            </div>
        </div>
        
        <footer>
            Built with ‚òï by <a href="https://github.com/Fevit1/collectioncalc" target="_blank">CollectionCalc</a>
        </footer>
    </div>
    
    <!-- Auth Modal -->
    <div class="auth-modal-overlay" id="authModal">
        <div class="auth-modal">
            <button class="auth-modal-close" onclick="closeAuthModal()">&times;</button>
            <div class="auth-modal-header">
                <h2 id="authModalTitle">Welcome Back</h2>
                <p id="authModalSubtitle">Log in to save your collection</p>
            </div>
            <div class="auth-modal-body">
                <div class="auth-tabs">
                    <button class="auth-tab active" id="tabLogin" onclick="switchAuthTab('login')">Log In</button>
                    <button class="auth-tab" id="tabSignup" onclick="switchAuthTab('signup')">Sign Up</button>
                </div>
                
                <div class="auth-error" id="authError"></div>
                <div class="auth-success" id="authSuccess"></div>
                
                <!-- Login Form -->
                <form class="auth-form active" id="loginForm" onsubmit="handleLogin(event)">
                    <div class="form-group">
                        <label for="loginEmail">Email</label>
                        <input type="email" id="loginEmail" placeholder="you@example.com" required>
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">Password</label>
                        <input type="password" id="loginPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                    </div>
                    <button type="submit" id="loginBtn">Log In</button>
                    <div class="auth-footer">
                        <button type="button" class="auth-link" onclick="showForgotPassword()">Forgot password?</button>
                    </div>
                </form>
                
                <!-- Signup Form -->
                <form class="auth-form" id="signupForm" onsubmit="handleSignup(event)">
                    <div class="form-group">
                        <label for="signupEmail">Email</label>
                        <input type="email" id="signupEmail" placeholder="you@example.com" required>
                    </div>
                    <div class="form-group">
                        <label for="signupPassword">Password</label>
                        <input type="password" id="signupPassword" placeholder="At least 8 characters" minlength="8" required>
                    </div>
                    <div class="form-group">
                        <label for="signupPasswordConfirm">Confirm Password</label>
                        <input type="password" id="signupPasswordConfirm" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                    </div>
                    <button type="submit" id="signupBtn">Create Account</button>
                    <div class="auth-footer">
                        Already have an account? <button type="button" class="auth-link" onclick="switchAuthTab('login')">Log in</button>
                    </div>
                </form>
                
                <!-- Forgot Password Form -->
                <form class="auth-form" id="forgotForm" onsubmit="handleForgotPassword(event)">
                    <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 16px;">
                        Enter your email and we'll send you a link to reset your password.
                    </p>
                    <div class="form-group">
                        <label for="forgotEmail">Email</label>
                        <input type="email" id="forgotEmail" placeholder="you@example.com" required>
                    </div>
                    <button type="submit" id="forgotBtn">Send Reset Link</button>
                    <div class="auth-footer">
                        <button type="button" class="auth-link" onclick="switchAuthTab('login')">‚Üê Back to login</button>
                    </div>
                </form>
                
                <!-- Reset Password Form -->
                <form class="auth-form" id="resetForm" onsubmit="handleResetPassword(event)">
                    <div class="form-group">
                        <label for="resetPassword">New Password</label>
                        <input type="password" id="resetPassword" placeholder="At least 8 characters" minlength="8" required>
                    </div>
                    <div class="form-group">
                        <label for="resetPasswordConfirm">Confirm New Password</label>
                        <input type="password" id="resetPasswordConfirm" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                    </div>
                    <button type="submit" id="resetBtn">Reset Password</button>
                </form>
                
                <!-- Verification Needed -->
                <div class="auth-form" id="verificationNeeded">
                    <div style="text-align: center; padding: 20px 0;">
                        <div style="font-size: 48px; margin-bottom: 15px;">üìß</div>
                        <p style="color: var(--text-secondary); margin-bottom: 20px;">
                            Please verify your email to continue. Check your inbox for a verification link.
                        </p>
                        <button type="button" class="btn-secondary" onclick="resendVerification()">Resend Verification Email</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- eBay Listing Preview Modal -->
    <div class="listing-modal-overlay" id="listingModal">
        <div class="listing-modal">
            <div class="listing-modal-header">
                <h3>üì¶ Preview eBay Listing</h3>
                <button class="listing-modal-close" onclick="closeListingModal()">&times;</button>
            </div>
            <div class="listing-modal-body" id="listingModalBody">
                <!-- Content loaded dynamically -->
            </div>
            <div class="listing-modal-footer">
                <button class="listing-btn-cancel" onclick="closeListingModal()">Cancel</button>
                <button class="listing-btn-confirm" id="confirmListingBtn" onclick="confirmListing()">
                    Confirm & List on eBay
                </button>
            </div>
        </div>
    </div>
    
    <script src="app.js"></script>
</body>
</html>
