# CollectionCalc / Slab Worthy Roadmap

## Executive Summary

**CollectionCalc** is an AI-powered comic book valuation and grading assessment platform. Our flagship feature, **Slab Worthy?**, uses a patent-pending multi-angle photography system to help collectors decide if their comics are worth professional grading.

### Current State (v2.99.0)
- **Core Features Working:** Manual Entry, Photo Upload, and Slab Worthy all functional
- **Single Source of Truth:** All extraction flows now use unified backend logic
- **Valuation Engine:** eBay market data with exponential decay recency weighting
- **20-Tier Slab Premium Model:** Data-driven grade-to-slab value calculations

### Critical Priority: Barcode Scanning
Our #1 technical priority is reliable barcode reading. The 5-digit UPC supplement on comic barcodes definitively identifies:
- **Printing number** (1st, 2nd, 3rd) - Critical for valuation (Spawn #1: $300 first print vs $25 reprint)
- **Cover variant** (A, B, C) - Affects collectibility and value

**Status:** Infrastructure ready, blocked on Docker deployment for system library installation.

### Recent Wins (Session 20)
- Unified extraction backend (one prompt to maintain)
- Writer/Artist extraction working
- Barcode decode function ready
- UI cleanup (Artist field)

### Key Metrics
- **Hosting:** Render ($7/mo), Cloudflare Pages (free)
- **Response Time:** <5 seconds for valuations
- **Patent:** Provisional filed January 27, 2026

### Competitive Advantage
Unlike competitors who rely solely on database lookups, CollectionCalc uses:
1. Real-time eBay market data (not static price guides)
2. AI-powered photo analysis (extracts title, issue, condition)
3. Multi-angle grading assessment (patent pending)
4. Barcode verification (in progress) for reprint/variant detection

### Next Milestones
1. **Docker deployment** â†’ Enable barcode scanning
2. **Reprint detection** â†’ Filter reprints from valuation comps
3. **Version 3.0** â†’ Full barcode integration + improved accuracy

---

## Current Version: 2.99.0 (January 31, 2026)

### ðŸŽ‰ PATENT PENDING
Provisional patent filed for multi-angle comic grading system (January 27, 2026).

---

## Recently Completed

### v2.99.0 - Single Source of Truth & Barcode Infrastructure (Session 20) ðŸ†•
- [x] **Photo Upload uses backend extraction** - Removed ~90 lines of hardcoded prompt from app.js
- [x] **Single source of truth achieved** - Both Photo Upload AND Slab Worthy use `/api/extract`
- [x] **New extraction schema deployed:**
  - `writer` - Extracts writer credits from cover
  - `artist` - Extracts artist credits from cover
  - `barcode_digits` - Field ready for 5-digit UPC supplement
  - `signatures[]` - Array format for future signature detection
  - `is_facsimile` - Detects facsimile editions
- [x] **Writer/Artist extraction working** - Successfully tested with Absolute Batman (Scott Snyder / Nick Dragotta)
- [x] **UI updated** - "Variant" field renamed to "Artist", auto-populates from extraction
- [x] **Barcode infrastructure ready:**
  - `decode_barcode()` function in comic_extraction.py
  - Decodes issue, cover letter (A/B/C), printing number
  - Returns `is_variant` and `is_reprint` flags
  - pyzbar + Pillow added to requirements.txt
- [x] **Signature analysis preserved** - Detailed instructions commented out for future re-enabling
- [x] **Debug endpoint added** - `/api/debug/prompt-check` for deployment verification

### v2.98.0 - Deterministic Grading & UI Polish (Session 18-19)
- [x] **Slab Worthy uses backend extraction** - Step 1 now calls /api/extract
- [x] **barcode_digits field added** - Extracts 5-digit UPC add-on code
- [x] **Deterministic grading** - Added temperature=0 to all Claude API calls
- [x] **20-tier slab premium model** - Granular grade-based premiums
- [x] **Exponential decay recency** - 30-day half-life for eBay data weighting
- [x] **Whatnot extension v2.41.1** - Fixed null polling, interval cleanup
- [x] **Server-side garbage filter** - Blocks invalid valuation requests
- [x] **UI Polish:**
  - "Upload from Gallery" â†’ "Upload" (shorter, cleaner)
  - Slab icon + "Should You Slab It?" branding

### v2.97.0 - Mobile Fixes & Gallery Upload (Sessions 15-17)
- [x] **Login persistence fixed** - Token now properly loads from localStorage
- [x] **Mobile extraction working** - Was auth issue, not extraction bug
- [x] **Rotation detection improved** - AI checks TEXT only, ignores artistic elements
- [x] **Upload from Gallery** - Slab Worthy now has "Take Photo" + "Upload" buttons
- [x] **Server slowdown diagnosed** - Whatnot extension was polling with null issue
- [x] **Auto-rotation prompts for steps 2-4** - Added is_upside_down check

### v2.96.0 - Auto-Rotation & Code Split (Session 13-14)
- [x] **Auto-rotate landscapeâ†’portrait** - Comics are always taller than wide
- [x] **Auto-detect upside-down** - AI checks orientation, rotates 180Â° if needed
- [x] **Split app.js into 4 modules** - Prevents file truncation
  - `js/utils.js` - Shared state, image processing, UI helpers
  - `js/auth.js` - Authentication, user menu, collection
  - `js/app.js` - eBay, photo upload, valuation, manual entry
  - `js/grading.js` - Slab Worthy 4-photo flow
- [x] **"Upright" instruction text** - Guides users to reduce re-analysis costs
- [x] **Rotate button debounce** - 2.5s cooldown prevents rapid clicks

### v2.95.0 - Slab Worthy Live! (Session 12)
- [x] **Fixed truncated app.html** - Missing script tag caused setMode undefined
- [x] **Added defensive null checks** - Grading report won't crash on missing elements
- [x] **Slab Worthy deployed to production** - Feature is LIVE

### v2.94.0 - Slab Worthy! (Session 11)
- [x] **Provisional patent filed** - USPTO, Small Entity
- [x] **"Slab Worthy?" tab** - 4-photo grading assessment
- [x] Sequential photo capture flow (Front â†’ Spine â†’ Back â†’ Centerfold â†’ Report)
- [x] Device detection (mobile camera vs desktop upload)
- [x] Photo quality feedback (blur, dark, glare warnings)
- [x] Grade report with defects by area
- [x] "Should you grade?" economic recommendation
- [x] Confidence scaling (65% â†’ 94% based on photos)

---

## In Progress ðŸš§

### CRITICAL: Docker Deployment for Barcode Scanning
**Status:** Blocked - needs Docker environment

**Problem:**
- pyzbar Python package installed successfully
- Requires `libzbar0` system library to function
- Render's native Python environment won't install system packages
- Aptfile ignored when custom build command exists
- apt-get fails with read-only filesystem error

**Solution:**
```dockerfile
FROM python:3.11-slim
RUN apt-get update && apt-get install -y libzbar0 && rm -rf /var/lib/apt/lists/*
WORKDIR /app
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt
COPY . .
CMD ["gunicorn", "wsgi:app", "--timeout", "300", "--bind", "0.0.0.0:10000"]
```

**Next Steps:**
1. Create Dockerfile in repo root
2. Change Render Environment from "Python" to "Docker"
3. Clear cache and deploy
4. Verify pyzbar loads (no "not available" message in logs)
5. Test barcode extraction with real comic image

**Why This Matters:**
- Spawn #1 problem: Can't distinguish $25 reprints from $300 first prints
- 5th barcode digit definitively identifies printing (1st, 2nd, 3rd)
- 4th digit identifies cover variant (A, B, C)
- Critical competitive differentiator

---

## Known Bugs

- [ ] ðŸ› **Thinking animation not showing** - Code added but not appearing in Slab Worthy Step 5
- [ ] ðŸ› **Photo Upload missing thinking animation** - Needs same treatment as Slab Worthy
- [ ] ðŸ› **Auto-rotation steps 2-4** - Code added but not working
- [ ] ðŸ› **Hide "Take Photo" on desktop** - Only show "Upload" button on non-mobile

---

## Backlog

### High Priority (After Docker/Barcode)
- [ ] **Use barcode data in valuations** - Filter reprints from comparable sales
- [ ] **Reprint/variant warnings in UI** - Alert users when detected
- [ ] **Test with known reprints** - Spawn #1, Walking Dead #1, etc.
- [ ] **Key issue sanity check** - Database of floor prices to catch bad values
- [ ] **Whatnot Auction Integration** - Create listings from graded comics

### Medium Priority
- [ ] **Prompt Management Admin Page** - View/edit all prompts in one place
- [ ] **Add Writer field to UI** - Currently only Artist shown
- [ ] **Slab Premium Admin Panel** - Data-driven premium model management
- [ ] **Valuation confidence display** - Show sample size, data quality
- [ ] **Save graded comic to collection**
- [ ] **Grade report sharing/export**

### Low Priority / Future
- [ ] **Re-enable signature detection** - Instructions preserved in prompt
- [ ] **Sports cards support**
- [ ] **Pokemon cards support**
- [ ] **Pricing model decisions** - Free tier vs paid tiers
- [ ] **FAQ content** - Pressing, newsstand vs direct, methodology

---

## Patent Coverage

**Title:** System and Method for Automated Comic Book Condition Assessment Using Multi-Angle Imaging and Artificial Intelligence

**Key Claims:**
1. Multi-angle photography method (front, spine, back, centerfold)
2. AI defect detection across multiple views
3. Confidence scaling based on photo count
4. Image quality feedback loop
5. Economic decision engine ("should you grade?")
6. Signature detection module
7. Facsimile detection module
8. Auto-orientation correction (landscape/upside-down)
9. Barcode-based variant identification

**Status:** Provisional filed January 27, 2026
**Deadline:** File utility patent by January 27, 2027

---

## Version History

| Version | Date | Highlights |
|---------|------|------------|
| 2.99.0 | Jan 31, 2026 | ðŸŽ¯ Single source extraction, writer/artist, barcode infrastructure |
| 2.98.0 | Jan 30, 2026 | ðŸŽ¯ Deterministic grading, 20-tier slab model, UI polish |
| 2.97.0 | Jan 29, 2026 | ðŸ“± Mobile fixes, Gallery upload |
| 2.96.0 | Jan 28, 2026 | ðŸ”„ Auto-rotation, JS modular split |
| 2.95.0 | Jan 28, 2026 | ðŸš€ Slab Worthy LIVE, bug fixes |
| 2.94.0 | Jan 27, 2026 | ðŸ“² Slab Worthy!, Patent filed |
| 2.93.0 | Jan 26, 2026 | Signature/facsimile detection |
| 2.92.0 | Jan 25, 2026 | NLQ, Admin dashboard |
| 2.91.0 | Jan 24, 2026 | eBay QuickList |
| 2.90.0 | Jan 22, 2026 | Authentication, beta codes |
| 2.80.0 | Jan 20, 2026 | Photo extraction, bulk upload |
| 2.70.0 | Jan 18, 2026 | Three-tier valuation |
| 2.60.0 | Jan 15, 2026 | Whatnot extension |
| 2.50.0 | Jan 12, 2026 | Market data integration |

---

*Last updated: January 31, 2026 (Session 20)*
*Next priority: Docker deployment for barcode scanning*

